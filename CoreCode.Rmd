---
title: "Immigration and Doctoral Dreariness"
author: "Aramis D. M. Valverde"
date: "12/10/2021"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Is It Perhaps Different Doing A PhD In A Country You Grew Up In As Opposed to One That You Moved To?
### I Mean Probably, IDK Though, Lets Find Out!


### Like All Good Articles, We Start With The Abstract

#### Abstract


A 2019 Nature survey of doctoral students worldwide conducted by Shift Learning, [a UK based education market research and consulting firm](https://www.shift-learning.co.uk/), demonstrated that PhD students are not doing all that well. The Nature [write up by Chris Woolston](https://www.nature.com/articles/d41586-019-03459-7) noted that more than a third of PhD students have sought help for anxiety or depression caused by their their PhD studies, and more than a fifth of PhD students had experienced discrimination or harassment in their PhD program. Prior research has backed up the concept that PhD students and graduate students at large aren't doing so hot, . As a PhD student I thought, "yeah, I feel it, its pretty bad, I'm pretty sad.". However I made a startling realization that at least I didn't have to deal with being an actual immigrant or a woman. But then one asks oneself, "huh, is it actually worse?". Maybe Bill O'Rielly was right when he said that women don't feel discrimination in the workplace.

To analyze if it is worse to be a woman, or an immigrant, as opposed to not those things, I analyzed Nature's data set as published on figshare. I would have analyzed the data for trans people, however, they're rolled into the male and female. Gender queer was included, so I will attempt an analysis, however that was a very small number of persons, so I may not be able to demonstrate a significant difference even if one is liable to exist (previous research indicates significant differences with all of the aforementioned groups). 

The results were xyz, abc, def, ghi, jkl, mno, pqr, stu, vwx, yza.

https://group.springernature.com/gp/group/media/press-releases/archive-2019/nature-phd-survey-puts-spotlight-on-mental-health/17372858
https://www.zmescience.com/other/pieces/journals-to-blame-poor-phd-mental-health-0432/
https://www.insidehighered.com/news/2019/11/14/phd-student-poll-finds-mental-health-bullying-and-career-uncertainty-are-top
https://www.nature.com/articles/d41586-019-03535-y

https://figshare.com/articles/dataset/Data_publication_survey_raw_data/1234052
https://figshare.com/articles/dataset/Nature_Graduate_Survey_2017/5480716?file=9558301

https://www.nature.com/articles/nj7677-549a




##### Background:




This is the github post that lead me to the data set
https://github.com/rfordatascience/tidytuesday/issues/153
This is the dataset
https://figshare.com/s/74a5ea79d76ad66a8af8
This is the course that I am writing this code for
https://data-science-methods.github.io/project/




#### Methods


paste this in to hide output, code, and code: {r someVar,results='hide', echo=FALSE,include=FALSE}

Load in Libraries and Installations
```{r}
library(tidyverse)
library(readxl)
library(ggplot2)
library(tinytex)
library(RColorBrewer)
library(ggdist)
library(waffle)
library(dplyr)
```


Load in dataset that I downloaded from the link above(and which I placed into a "data" folder within the project folder)
```{r}
dfog <- read_excel("data/Nature_PhD survey_Anon_v1.xlsx")
```


This is meant to ensure that it all was imported properly
```{r}
glimpse(dfog)
```


Just to check that the top has been preserved.
```{r}
head(dfog)
```


So there are alot of NA's here, I am removing those by combining bits that perhaps ought not have been separated out. The demographic data, for example, appears to have only one value per row(individual) and yet is scattered across multiple columns. I will combine Q58:1 to Q58.Am while excluding Q58:11, as that one is just specifying that a person is another ethnicity, which they then typed out by hand.
First, I will remove the column Q58:11, and then combine the aforementioned sections.
To remove Q58:11 I will have to rename it, as the ":" in the name causes issues in function"select".
```{r}
df1 <- dfog
df2 <- df1 #%>% dplyr::rename(delete = 259)
df3 <- df2 #%>% select(-delete)

```


In hindsight, why not just remove the top row and use the second row (the questions themselves) as the column identifier? That would make this easier, no?
```{r}
df4<-df3
names(df4) <- as.matrix(df4[1, ])
df4 <- df4[-1, ]
df4[] <- lapply(df4, function(x) type.convert(as.character(x)))
```


remove all columns where all values are NA
```{r}
df5 <- df4
df6a <- df5[ , colSums(is.na(df4)) < nrow(df4)]
```


All this to combine the demographic data

Before I do that, I have to rename columns that currently have the same name. I swear this data set was meant to frustrate me. Also I have to rename column 117 in df6a, because the column name is blank. Not sure how the bottom bit works with attributing df6 to df6a after I declared df6, but it does. I tried it other ways and it didn't output a df6. comment out df6 <- df6a and test yourself if ya like.
I have now decided to use this path to rename all bits, because it wont work otherwise with dplyr's tools, only with base r.
```{r}
df6 <- df6a
df6 <- names(df6a)[117] <- "How much do you expect your PhD to improve your job prospects?"     ###AV Coulumn name/question is sourced from Nature_GradSurvey_Script2019_Final1.docx, named cause it was blank


###AV Rename all duplicates of "If other, please specify" and make unique
df6 <- names(df6a)[12] <- "specified1" 
df6 <- names(df6a)[16] <- "specified2" 
df6 <- names(df6a)[22] <- "specified3" 

df6 <- names(df6a)[34] <- "specified4" 
df6 <- names(df6a)[37] <- "specified5" 
df6 <- names(df6a)[54] <- "specified6" 
df6 <- names(df6a)[79] <- "specified7" 
df6 <- names(df6a)[89] <- "specified8"

df6 <- names(df6a)[104] <- "specified9" 
df6 <- names(df6a)[116] <- "specified10" 
df6 <- names(df6a)[139] <- "specified11" 
df6 <- names(df6a)[141] <- "specified12" 
df6 <- names(df6a)[146] <- "specified13" 

df6 <- names(df6a)[158] <- "specified14" 
df6 <- names(df6a)[173] <- "specified15" 
df6 <- names(df6a)[183] <- "specified16" 
df6 <- names(df6a)[191] <- "specified17" 
df6 <- names(df6a)[200] <- "specified18"

df6 <- names(df6a)[225] <- "specified19" 
df6 <- names(df6a)[233] <- "specified20" 
df6 <- names(df6a)[239] <- "specified21" 
df6 <- names(df6a)[255] <- "specified22" 
df6 <- names(df6a)[261] <- "specified23"



###AV Rename all duplicates of "What prompted you to study outside your country of upbringing" and make unique
df6 <- names(df6a)[23] <- "prompt to study outside country of upbringing1" 
df6 <- names(df6a)[24] <- "prompt to study outside country of upbringing2" 
df6 <- names(df6a)[25] <- "prompt to study outside country of upbringing3" 
df6 <- names(df6a)[26] <- "prompt to study outside country of upbringing4" 
df6 <- names(df6a)[27] <- "prompt to study outside country of upbringing5" 
df6 <- names(df6a)[28] <- "prompt to study outside country of upbringing6" 
df6 <- names(df6a)[29] <- "prompt to study outside country of upbringing7" 
df6 <- names(df6a)[30] <- "prompt to study outside country of upbringing8" 
df6 <- names(df6a)[31] <- "prompt to study outside country of upbringing9" 
df6 <- names(df6a)[32] <- "prompt to study outside country of upbringing10" 
df6 <- names(df6a)[33] <- "prompt to study outside country of upbringing11" 


###AV Rename all duplicates of "Who was the perpetrator(s)" and make unique
df6 <- names(df6a)[97] <-  "positionOfPerpetrator1" 
df6 <- names(df6a)[98] <-  "positionOfPerpetrator2" 
df6 <- names(df6a)[99] <-  "positionOfPerpetrator3" 
df6 <- names(df6a)[100] <- "positionOfPerpetrator4" 
df6 <- names(df6a)[101] <- "positionOfPerpetrator5" 
df6 <- names(df6a)[102] <- "positionOfPerpetrator6" 
df6 <- names(df6a)[103] <- "positionOfPerpetrator7" 


###AV Rename all duplicates of "Which of the following have you experienced?" and make unique
df6 <- names(df6a)[107] <- "experience1" 
df6 <- names(df6a)[108] <- "experience2" 
df6 <- names(df6a)[109] <- "experience3" 
df6 <- names(df6a)[110] <- "experience4" 
df6 <- names(df6a)[111] <- "experience5" 
df6 <- names(df6a)[112] <- "experience6" 
df6 <- names(df6a)[113] <- "experience7" 
df6 <- names(df6a)[114] <- "experience8" 
df6 <- names(df6a)[115] <- "experience9" 


###AV Rename all duplicates of "If youâ€™re unlikely to pursue an academic research career, what are the main reasons??" and make unique
df6 <- names(df6a)[130] <- "reasonUnlikelyAcademicCarreerPursuit1" 
df6 <- names(df6a)[131] <- "reasonUnlikelyAcademicCarreerPursuit2" 
df6 <- names(df6a)[132] <- "reasonUnlikelyAcademicCarreerPursuit3" 
df6 <- names(df6a)[133] <- "reasonUnlikelyAcademicCarreerPursuit4" 
df6 <- names(df6a)[134] <- "reasonUnlikelyAcademicCarreerPursuit5" 
df6 <- names(df6a)[135] <- "reasonUnlikelyAcademicCarreerPursuit6" 
df6 <- names(df6a)[136] <- "reasonUnlikelyAcademicCarreerPursuit7" 
df6 <- names(df6a)[137] <- "reasonUnlikelyAcademicCarreerPursuit8" 
df6 <- names(df6a)[138] <- "reasonUnlikelyAcademicCarreerPursuit9" 

###AV Rename all duplicates of "How did you arrive at your current career decision? Plea..." and make unique
df6 <- names(df6a)[147] <- "HowArriveAtCareerDecision1" 
df6 <- names(df6a)[148] <- "HowArriveAtCareerDecision2" 
df6 <- names(df6a)[149] <- "HowArriveAtCareerDecision3" 
df6 <- names(df6a)[151] <- "HowArriveAtCareerDecision4" 
df6 <- names(df6a)[152] <- "HowArriveAtCareerDecision5" 
df6 <- names(df6a)[153] <- "HowArriveAtCareerDecision6" 
df6 <- names(df6a)[154] <- "HowArriveAtCareerDecision7" 
df6 <- names(df6a)[155] <- "HowArriveAtCareerDecision8" 
df6 <- names(df6a)[156] <- "HowArriveAtCareerDecision9" 
df6 <- names(df6a)[157] <- "HowArriveAtCareerDecision10" 

###AV Rename all duplicates of "How do you learn about available career opportunities that are beyond academia?" and make unique
df6 <- names(df6a)[159] <- "HowLearnCareerNotAcademia1" 
df6 <- names(df6a)[160] <- "HowLearnCareerNotAcademia2" 
df6 <- names(df6a)[161] <- "HowLearnCareerNotAcademia3" 
df6 <- names(df6a)[162] <- "HowLearnCareerNotAcademia4" 
df6 <- names(df6a)[163] <- "HowLearnCareerNotAcademia5" 
df6 <- names(df6a)[164] <- "HowLearnCareerNotAcademia6" 
df6 <- names(df6a)[165] <- "HowLearnCareerNotAcademia7" 
df6 <- names(df6a)[166] <- "HowLearnCareerNotAcademia8" 
df6 <- names(df6a)[167] <- "HowLearnCareerNotAcademia9" 
df6 <- names(df6a)[168] <- "HowLearnCareerNotAcademia10" 
df6 <- names(df6a)[169] <- "HowLearnCareerNotAcademia11" 
df6 <- names(df6a)[170] <- "HowLearnCareerNotAcademia12" 
df6 <- names(df6a)[171] <- "HowLearnCareerNotAcademia13" 
df6 <- names(df6a)[172] <- "HowLearnCareerNotAcademia14" 

###AV Rename all duplicates of "Which of the following 3 things would you say are the most difficult for PhD students in your discipline?" and make unique
df6 <- names(df6a)[174] <- "DifficultInDiscipline1" 
df6 <- names(df6a)[175] <- "DifficultInDiscipline2" 
df6 <- names(df6a)[176] <- "DifficultInDiscipline3" 
df6 <- names(df6a)[177] <- "DifficultInDiscipline4" 
df6 <- names(df6a)[178] <- "DifficultInDiscipline5" 
df6 <- names(df6a)[179] <- "DifficultInDiscipline6" 
df6 <- names(df6a)[180] <- "DifficultInDiscipline7" 
df6 <- names(df6a)[181] <- "DifficultInDiscipline8" 
df6 <- names(df6a)[182] <- "DifficultInDiscipline9" 


###AV Rename all duplicates of "Which of the following would you say are the most difficult for PhD students in the country where you are studying?" and make unique
df6 <- names(df6a)[184] <- "DifficultInCountry1" 
df6 <- names(df6a)[185] <- "DifficultInCountry2" 
df6 <- names(df6a)[186] <- "DifficultInCountry3" 
df6 <- names(df6a)[187] <- "DifficultInCountry4" 
df6 <- names(df6a)[188] <- "DifficultInCountry5" 
df6 <- names(df6a)[189] <- "DifficultInCountry6" 
df6 <- names(df6a)[190] <- "DifficultInCountry7" 

###AV Rename all duplicates of "Which of the following resources do you think PhD students need the most in order to establish a satisfying career?" and make unique
df6 <- names(df6a)[192] <- "ResourcesForSatisfyingCareer1" 
df6 <- names(df6a)[193] <- "ResourcesForSatisfyingCareer2" 
df6 <- names(df6a)[194] <- "ResourcesForSatisfyingCareer3" 
df6 <- names(df6a)[195] <- "ResourcesForSatisfyingCareer4" 
df6 <- names(df6a)[196] <- "ResourcesForSatisfyingCareer5" 

df6 <- names(df6a)[197] <- "ResourcesForSatisfyingCareer6" 
df6 <- names(df6a)[198] <- "ResourcesForSatisfyingCareer7" 
df6 <- names(df6a)[199] <- "ResourcesForSatisfyingCareer8" 

###AV Rename all duplicates of "Which, if any, of the following activities have you done to advance your career?" and make unique
df6 <- names(df6a)[217] <- "ActivitiesToAdvanceCareer1" 
df6 <- names(df6a)[218] <- "ActivitiesToAdvanceCareer2" 
df6 <- names(df6a)[219] <- "ActivitiesToAdvanceCareer3" 
df6 <- names(df6a)[220] <- "ActivitiesToAdvanceCareer4" 
df6 <- names(df6a)[221] <- "ActivitiesToAdvanceCareer5" 

df6 <- names(df6a)[222] <- "ActivitiesToAdvanceCareer6" 
df6 <- names(df6a)[223] <- "ActivitiesToAdvanceCareer7" 
df6 <- names(df6a)[224] <- "ActivitiesToAdvanceCareer8" 


###AV Rename all duplicates of "Which of the following social media networks have you used to build your professional network" and make unique
df6 <- names(df6a)[226] <- "SocialMediaToBuildNetwork1" 
df6 <- names(df6a)[227] <- "SocialMediaToBuildNetwork2" 
df6 <- names(df6a)[228] <- "SocialMediaToBuildNetwork3" 
df6 <- names(df6a)[229] <- "SocialMediaToBuildNetwork4" 
df6 <- names(df6a)[230] <- "SocialMediaToBuildNetwork5" 
df6 <- names(df6a)[231] <- "SocialMediaToBuildNetwork6" 
df6 <- names(df6a)[232] <- "SocialMediaToBuildNetwork7" 

###AV Rename all duplicates of "What would you do differently right now if you were starting your programme?" and make unique
df6 <- names(df6a)[234] <- "DoDifferently1" 
df6 <- names(df6a)[235] <- "DoDifferently2" 
df6 <- names(df6a)[236] <- "DoDifferently3" 
df6 <- names(df6a)[237] <- "DoDifferently4" 
df6 <- names(df6a)[238] <- "DoDifferently5" 


###AV Rename all duplicates of "Which of the following best describes you?" and make unique
df6 <- names(df6a)[243] <- "BestDescribes1" 
df6 <- names(df6a)[244] <- "BestDescribes2" 
df6 <- names(df6a)[245] <- "BestDescribes3" 
df6 <- names(df6a)[246] <- "BestDescribes4" 
df6 <- names(df6a)[247] <- "BestDescribes5" 

df6 <- names(df6a)[248] <- "BestDescribes6" 
df6 <- names(df6a)[249] <- "BestDescribes7" 
df6 <- names(df6a)[250] <- "BestDescribes8" 
df6 <- names(df6a)[251] <- "BestDescribes9" 
df6 <- names(df6a)[252] <- "BestDescribes10"

df6 <- names(df6a)[253] <- "BestDescribes11" 
df6 <- names(df6a)[254] <- "BestDescribes12"


###AV Rename all duplicates of "Do you have any caring responsibilities" and make unique
df6 <- names(df6a)[256] <- "CaringResponsibilities1" 
df6 <- names(df6a)[257] <- "CaringResponsibilities2" 
df6 <- names(df6a)[258] <- "CaringResponsibilities3" 
df6 <- names(df6a)[259] <- "CaringResponsibilities4" 
df6 <- names(df6a)[260] <- "CaringResponsibilities5" 

df6 <- names(df6a)[242] <- "Gender" 

#df6 <- names(df5)[20] <- "delete2"  
#df6 <- names(df6a)[] <- "" 
df6 <- df6a

#code adapted from https://www.statology.org/how-to-rename-data-frame-columns-in-r/ and https://www.sharpsightlabs.com/blog/rename-columns-in-r/
#df6 <- names(df5) <- c("miles_gallon", "cylinders", "display", "horsepower")

###AV This bottom bit told me what I am missing to rename and make not identical
###rename(df6, combine1 = 150)


###df6 <- rename(df5, xyz=1) ###AV Didnt Work. Will use something other than rename

###df6 %>% unite("ethnicity", 251:259, remove = FALSE)

###AV Template for above
####AV Rename all duplicates of "" and make unique
#df6 <- names(df6a)[] <- "" 
#df6 <- names(df6a)[] <- "" 
#df6 <- names(df6a)[] <- "" 
#df6 <- names(df6a)[] <- "" 
#df6 <- names(df6a)[] <- "" 

###Finished Product: df7
df7 <- df6

```


actually combine demographic data
```{r}
df8 <- unite(df7, "ethnicityGroupedOther",  243:254, remove = FALSE, na.rm = TRUE)
#df7 %>% unite("ethnicityOtherWriteInIncluded", 2,remove= FALSE) specified22 is variable that has the write in ethnicity data
df9 <- unite(df8, "ethnicityOtherWriteInNotYetIncluded", 244:252, remove = FALSE, na.rm = TRUE)
###AV Ensure that all NA values remain as NA, as the above unite processes seem to convert NA to blanks after uniting. Comment out the 2 lines below to confirm.
df10 <- df9 
df10[df10 == ""] <- NA 
###AV finally combine them all
df11 <- unite(df10, "ethnicityOtherWriteInIncluded", c('ethnicityOtherWriteInNotYetIncluded', 'specified22') , remove = FALSE, na.rm = TRUE)
```


well doing that wasn't quite useful, because now I will focus on PEOPLE WHO MOVED INTO A COUNTRY FROM ELSEWHERE. Not on ethnicity. But this is EDA, so the clear and distinct lack of direction is a feature, not a bug.
```{r}
#df12 <- df11[c(201:216)]
#df13 <- df11[c(242)]
#df14 <- merge(df12,df13) ###running this causes an error *** recursive gc invocation... which then causes a Rstudio to crash.
#df[df$var1 == 'value', ] 

###df12 contains gender, 
df12 <- df11[c(201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,242)]

df12Male <- df12[df12$'Gender' == 'Male (including trans male)',]
df12Female <- df12[df12$'Gender' == 'Female (including trans female)',]
df12GenderQueerandorNonBinary <- df12[df12$'Gender' == 'Gender queer / Non binary',]

```


Analysis of Gender Variations in Training Satisfaction
```{r}
#str(df12)
#summary(df12)

#[1] 5
```


the actual analysis to be graphed! Woo!!!
```{r}
df13 <- df12Male

df14 <- names(df13)[1] <- "Collecting" 
ggplot(df13, aes( Collecting, colour = Gender)) + 
  geom_bar()

dfgender <- table(df12['Gender'])
df15<- as.data.frame(dfgender)


table(df12$Gender)/length(df12$Gender)

```


Some more data wrangling
```{r}

df15 <- names(df12)[1] <- "Collecting"
df15 <- df12
df <- df15
```







### Graphs!!!

first graph, not incredibly interesting and also hampered by small sample size of Gender Queer/Non Binary  and Prefer Not To Say
```{r}
ggplot(data = df) + 
  geom_bar(mapping = aes(x = Gender, fill = Collecting), position = "dodge")+
  scale_colour_brewer(palette = "BrBg") +
  scale_fill_brewer(palette = "BrBG")


#dodge <- position_dodge(width = 0.9)+

#gg <- ggplot(df)
#gg <- gg + geom_bar(aes(x = Gender, y = Collecting, fill = Gender), 
  #                  position="dodge", stat = "identity")


#print(gg)

#ggplot(df, aes(x = interaction(Gender,Collecting), y = yield, fill = factor(geno))) +
 # geom_bar(stat = "identity", position = position_dodge()) +
  #geom_errorbar(aes(ymax = yield + SE, ymin = yield - SE), position = dodge, width = 0.2)

```


Better plot
```{r}
ggplot(data = df) + 
  geom_bar(mapping = aes(x = Gender, fill = Collecting), position = "fill")+
  scale_colour_brewer(palette = "BrBg") +
  scale_fill_brewer(palette = "BrBG")
```


better plot that fails at reordering variables
```{r}


#dfnew1 <- df %>% arrange(Collecting) %>% mutate(name = factor(Collecting, levels=c("Very badly", "Badly", "Neither well not badly", "Well", "Very well", "Unsure/Not applicable")))


data_new <- df                             
data_new$group <- factor(data_new$Collecting,c("Very badly", "Badly", "Neither well not badly", "Well", "Very well", "Unsure/Not applicable"))
ggplot(data = data_new) + 
  geom_bar(mapping = aes(x = Gender, fill = Collecting), position = "fill")+
  scale_colour_brewer(palette = "BrBg") +
  scale_fill_brewer(palette = "BrBG")

```


This chunk contains the code to reorder variables manually. Finally figured out how to reorder this stuff. Goodness.
```{r}


#dfnew1 <- df %>% arrange(Collecting) %>% mutate(name = factor(Collecting, levels=c("Very badly", "Badly", "Neither well not badly", "Well", "Very well", "Unsure/Not applicable")))


data_new <- df
df <- data_new

df$Collecting <- factor(df$Collecting , levels=c("Very badly", "Badly", "Neither well nor badly", "Well", "Very well", "Unsure/Not applicable"))

data_new <- df
df <- data_new


ggplot(data = data_new) + 
  geom_bar(mapping = aes(x = Gender, fill = Collecting), position = "fill")+
  scale_colour_brewer(palette = "BrBg") +
  scale_fill_brewer(palette = "BrBG")

```


trash graph, redo later
```{r}
df %>%
  ggplot(aes(x=Gender, y= Collecting)) +
  stat_histinterval(position = "dodge") +
 theme_ggdist()
```


This will be the bread and butter of this assignment. It looks beautiful. Waffle Graph, must have info input manually. Still breautiful.
```{r}
parts <- c(`Un-breached\nUS Population` = (318 - 11 - 79), `Premera` = 11, `Anthem` = 79)

waffle(
  parts, rows = 8, size = 1,
  colors = c("#969696", "#1879bf", "#009bda"), legend_pos = "bottom"
)
```


Analysis that isnt working yet
```{r}
#lm1 <- lm(data = df, Collecting ~ Gender) # the model

#summary(lm1) # summarizes the output of the model
```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```


