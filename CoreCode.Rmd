---
title: "CoreCode"
author: "ADMValverde"
date: "12/10/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Background:
This is the github post that lead me to the dataset
https://github.com/rfordatascience/tidytuesday/issues/153
This is the dataset
https://figshare.com/s/74a5ea79d76ad66a8af8
This is the course that I am writing this code for
https://data-science-methods.github.io/project/


Load in Libraries and Installations
```{r}
library(tidyverse)
library(readxl)
```


Load in dataset that I downloaded from the link above(and which I placed into a "data" folder within the project folder)
```{r}
dfog <- read_excel("data/Nature_PhD survey_Anon_v1.xlsx")
```


This is meant to ensure that it all was imported properly
```{r}
glimpse(dfog)
```
Just to check that the top has been preserved.
```{r}
head(dfog)
```


So there are alot of NA's here, I am removing those by combining bits that perhaps ought not have been separated out. The demographic data, for example, appears to have only one value per row(individual) and yet is scattered across multiple columns. I will combine Q58:1 to Q58.Am while excluding Q58:11, as that one is just specifying that a person is another ethnicity, which they then typed out by hand.
First, I will remove the column Q58:11, and then combine the aforementioned sections.
To remove Q58:11 I will have to rename it, as the ":" in the name causes issues in function"select".
```{r}
df1 <- dfog
df2 <- df1 %>% dplyr::rename(delete = 259)
df3 <- df2 %>% select(-delete)

```


In hindsight, why not just remove the top row and use the second row (the questions themselves) as the column identifier? That would make this easier, no?
```{r}
df4<-df3
names(df4) <- as.matrix(df4[1, ])
df4 <- df4[-1, ]
df4[] <- lapply(df4, function(x) type.convert(as.character(x)))
```


remove all columns where all values are NA
```{r}
df5 <- df4
df6 <- df5[ , colSums(is.na(df4)) < nrow(df4)]
```



now to combine the demographic data, but before I have to rename those columns as they now have the same name. I swear this dataset was meant to frustrate me.Also I have to rename column 123, because it is blank. Not sure how the bottom bit works with attributing df6 to df5 after I declared df6, but it does. I tried it other ways and it didnt output a df6. comment out df6 <- df5 and test yourself if ya like.
I have now decided to use this path to rename all bits, because it wont work otherwise with dplyr's tools, only with base r.

```{r}
df5 <- df4
df6 <- names(df5)[123] <- "How much do you expect your PhD to improve your job prospects?"     ###AV Coulumn name/question is sourced from Nature_GradSurvey_Script2019_Final1.docx
df6 <- names(df5)[11] <- "delete1"                                                             ###Av delete because it has no values
df6 <- names(df5)[14] <- "Most important reason to get a phd other specified" 
df6 <- names(df5)[18] <- "other country of residence in asia specified"                                ###AV all Taiwan except one instance of Egypt
###AV Deleting empty columns
df6 <- names(df5)[20] <- "delete2"  
df6 <- names(df5)[22] <- "delete3"  
df6 <- names(df5)[24] <- "delete4"  
df6 <- names(df5)[26] <- "delete5"  

df6 <- names(df5)[11] <- "delete1"  
df6 <- names(df5)[11] <- "delete1"  
df6 <- names(df5)[11] <- "delete1"  
df6 <- names(df5)[11] <- "delete1"  
df6 <- names(df5)[11] <- "delete1"  
df6 <- names(df5)[11] <- "delete1"  
df6 <- names(df5)[11] <- "delete1"  
df6 <- names(df5)[11] <- "delete1"  
df6 <- names(df5)[11] <- "delete1"  






df6 <- df5
#code adapted from https://www.statology.org/how-to-rename-data-frame-columns-in-r/ and https://www.sharpsightlabs.com/blog/rename-columns-in-r/
#df6 <- names(df5) <- c("miles_gallon", "cylinders", "display", "horsepower")
#df6 <- rename(df5, xyz=1) ###AV Didnt Work. Will use something other than rename
#df5 %>% unite("ethnicity", 251:259, remove = FALSE)
#rename(df6, combine1 = 150)
```
Just notes from console to guide my renmaing. They'll remain here for posteriority.
x These names are duplicated:
  * "If other, please specify" at locations 11, 14, 18, 20, 22, etc.
  * "What prompted you to study outside your country of upbringing?" at locations 29, 30, 31, 32, 33, etc.
  * "Who was the perpetrator(s)?" at locations 103, 104, 105, 106, 107, etc.
  * "Which of the following have you experienced?" at locations 113, 114, 115, 116, 117, etc.
  * "If youâ€™re unlikely to pursue an academic research career, what are the main reasons?" at locations 136, 137, 138, 139, 140, etc.
  * ...


```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```


```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```


